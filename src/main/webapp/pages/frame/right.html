<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
	
	<body>
	
		<!-- less
			<link rel="stylesheet/less" type="text/css" th:href="@{/assets/less/test.less}"/>
	    	<script>less = { env: 'development'};</script>
	    	<script th:src="@{/assets/js/less_2.5.3.js}" type="text/javascript"></script>
	    	<script>less.watch();</script> 
	    -->
	    
	    <script type="text/javascript" th:src="@{/assets/js/echarts.js}"></script>
	    <script type="text/javascript" th:src="@{/assets/plugins/websocket/sockjs-0.3.4.js}"></script>
	    <script type="text/javascript" th:src="@{/assets/plugins/websocket/stomp.js}"></script>
		
		<script type="text/javascript" th:inline="javascript">
			/*<![CDATA[*/
		    var stompClient = null;    
			var rt = [[@{/}]];
			
			var socket = new SockJS(rt+'portfolio-stomp');

			var stompClient = Stomp.over(socket);
			//和服务器建立连接"SEND destination:http://localhost:8081/fang-bian-mian/app/handle content-length:14 {"name":"efw"}"
			stompClient.connect("", "", function(frame) {
				console.log(frame);
				//订阅消息
			    stompClient.subscribe(rt+'topic/greetings', function(data) { 
			    	 alert(data);
			         $("#response").text(data);
			    });  
			}); 

			$("#ws").click(function(){
				var name = $("#name").val();
				console.info(name);
				//发送消息
				stompClient.send(rt+"app/handler", {}, JSON.stringify({
							          'name' : name
							      }));
/* 				//发送消息
				stompClient.send("http://localhost:8081/fang-bian-mian/app/handler", {}, JSON.stringify({
							          'name' : name
							      })); */
			});
		    
		    /*]]>*/
		</script>	
		
		<script type="text/javascript">
	        $(function(){
	            var websocket;
	            if ('WebSocket' in window) {
	                alert("WebSocket");
	                websocket = new WebSocket("ws://localhost:8081/veg");
	            } else if ('MozWebSocket' in window) {
	                alert("MozWebSocket");
	                websocket = new MozWebSocket("ws://veg");
	            } else {
	                alert("SockJS");
	                websocket = new SockJS("http://localhost:8081/com/veg");
	            }
	            websocket.onopen = function (evnt) {
	                $("#head").html("连接服务器成功!")
	                send();
	            };
	            websocket.onmessage = function (evnt) {
	                $("#msg").html($("#msg").html() + "<br/>" + evnt.data);
	            };
	            websocket.onerror = function (evnt) {
	            };
	            websocket.onclose = function (evnt) {
	                $("#head").html("与服务器断开了链接!")
	            }
	            function send(){
	                if (websocket != null) {
	
	                    websocket.send("客户端请求");
	                } else {
	                    alert('未与服务器链接.');
	                }
	            }
	        });
	    </script>
		
		<div id="head">
		    webSocket消息推送
		</div>
		<div id="msg">
		</div>




















		<!-- <script type="text/javascript" th:inline="javascript">
			$(function(){
				// 基于准备好的dom，初始化echarts实例
		        var myChart = echarts.init(document.getElementById('main'));
		
		        // 指定图表的配置项和数据
		        var option = {
		            tooltip: {},
		            legend: {
		                data:['销量']
		            },
		            xAxis: {
		                data: ["衬衫","羊毛衫","雪纺衫","裤子","高跟鞋","袜子"]
		            },
		            yAxis: {},
		            series: [{
		                name: '销量',
		                type: 'bar',
		                data: [5, 20, 36, 10, 10, 20]
		            }]
		        };
		
		        // 使用刚指定的配置项和数据显示图表。
		        myChart.setOption(option);
			});
		</script> -->

		<!-- <div id="main" style="width: 600px;height:400px;"></div> -->
	</body>
</html>
