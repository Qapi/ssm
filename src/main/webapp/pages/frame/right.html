<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
	
	<body>
	
		<!-- less
			<link rel="stylesheet/less" type="text/css" th:href="@{/assets/less/test.less}"/>
	    	<script>less = { env: 'development'};</script>
	    	<script th:src="@{/assets/js/less_2.5.3.js}" type="text/javascript"></script>
	    	<script>less.watch();</script> 
	    -->
	    
	    <script type="text/javascript" th:src="@{/assets/js/echarts.js}"></script>
	    <script type="text/javascript" th:src="@{/assets/plugins/websocket/sockjs-0.3.4.js}"></script>
	    <script type="text/javascript" th:src="@{/assets/plugins/websocket/stomp.js}"></script>
		<script type="text/javascript" th:inline="javascript">
			$(function(){
				// 基于准备好的dom，初始化echarts实例
		        var myChart = echarts.init(document.getElementById('main'));
		
		        // 指定图表的配置项和数据
		        var option = {
		            tooltip: {},
		            legend: {
		                data:['销量']
		            },
		            xAxis: {
		                data: ["衬衫","羊毛衫","雪纺衫","裤子","高跟鞋","袜子"]
		            },
		            yAxis: {},
		            series: [{
		                name: '销量',
		                type: 'bar',
		                data: [5, 20, 36, 10, 10, 20]
		            }]
		        };
		
		        // 使用刚指定的配置项和数据显示图表。
		        myChart.setOption(option);
			});
		</script>
		
		<script type="text/javascript" th:inline="javascript">
			/*<![CDATA[*/
		    var stompClient = null;    
		    function setConnected(connected) {        
		        document.getElementById('connect').disabled = connected;        
		        document.getElementById('disconnect').disabled = !connected;        
		        document.getElementById('conversationDiv').style.visibility = connected ? 'visible' : 'hidden';        
		        document.getElementById('response').innerHTML = '';    
		    }    
		    // 开启socket连接
		    function connect() {        
		        var socket = new SockJS([[@{/}]]+'socket');        
		        stompClient = Stomp.over(socket);        
		        stompClient.connect({}, function () {    
		             setConnected(true);            
		        });    
		    }    
		    // 断开socket连接
		    function disconnect() {        
		        if (stompClient != null) {            
		            stompClient.disconnect();        
		        }        
		        setConnected(false);        
		        console.log("Disconnected");    
		    }    
		    // 向‘/app/change-notice’服务端发送消息
		    function sendName() {   
		        var value = document.getElementById('name').value;            
		        stompClient.send([[@{/}]]+"app/change-notice", {}, value);    
		        	noticeSocket();
		    }    
		    
	       /*  var noticeSocket = function () {    
	        	  var socket = new SockJS([[@{/}]]+'socket');      
	        	  var stompClient = Stomp.over(s);    
	        	  stompClient.connect({}, function () {         
	        	    console.log('notice socket connected!');
	        	    stompClient.subscribe([[@{/}]]+'topic/notice', function (data) {            
	        	      $('#msg').html(data.body);        
	        	    });    
	        	 });
        	};  */
        	
		    /*]]>*/
		</script>	
		
		
		
		
		
		<div id="main" style="width: 600px;height:400px;"></div>
		
		<div>    
		    <div>        
		        <button id="connect" onclick="connect();">Connect</button> 
		       <button id="disconnect" disabled="disabled" onclick="disconnect();">Disconnect</button>    
		    </div>    
		    <div id="conversationDiv">        
		        <p>            
		            <label>notice content?</label>        
		        </p>        
		        <p>            
		              <textarea id="name" rows="5"></textarea>        
		        </p>        
		        <button id="sendName" onclick="sendName();">Send</button>        
		        <p id="response"></p>   
		        <p>            
		              <textarea id="msg" rows="5"></textarea>        
		        </p> 
		    </div>
		</div>
	</body>
</html>
