<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
	<head th:include="fragment/import :: header"></head>
	<title>登录</title>
	
	<link rel="stylesheet" th:href="@{/assets/css/canvas.css}" />
	
	<script type="text/javascript" th:src="@{/assets/js/jquery.cookie.js}"></script>
	<script type="text/javascript" th:src="@{/assets/js/canvas.js}"></script>
	<script type="text/javascript" th:inline="javascript">
		/*<![CDATA[*/
		    //更新验证码
			function update(obj){
				obj.src = [[@{/captcha}]] + "?" + Math.random();
			}
		
			$(function(){
				//回显cookie中的值
				if ($.cookie("rember") == "true") {
					$("#rember").attr("checked", true);
					$("#j_username").textbox("setValue",$.cookie("userName"));
					$("#j_password").textbox("setValue",$.cookie("passWord"));
				}
				
				$("#login").click(function(){
					var fm = $("form");
					if(fm.form("validate")){
						//将用户信息保存到cookie中
						if (document.getElementById("rember").checked == true) {
							var userName = $("#j_username").textbox("getText");
							var passWord = $("#j_password").textbox("getText");
							$.cookie("rember", "true", {expires : 7}); // 存储一个带7天期限的 cookie
							$.cookie("userName", userName, {expires : 7}); // 存储一个带7天期限的 cookie
							$.cookie("passWord", passWord, {expires : 7}); // 存储一个带7天期限的 cookie
						} else {
							$.cookie("rember", "false", {expires : -1});
							$.cookie("userName", '', {expires : -1});
							$.cookie("passWord", '', {expires : -1});
						}

						fm.submit();
					}
				});
				
				//循环创建星星
				var body = $("body");
				for(var i = 0; i < 20; i++){
					//自由下落
					setTimeout(function(){
						var num = getRandomNum(10,document.body.clientWidth);
						var canv = $("<canvas id='"+num+"' onclick='move(this)' class='starFreeDown'>您的浏览器不支持canvas</canvas>");
						canv.css("left",num);
						body.prepend(canv);
						drawStar(""+num);
						/* setInterval(function(){
							canv.trigger("click");
						}, 1000); */
					},(i * 1000)); 
				} 
			});
			
			/* function move(obj){
				var position = obj.offsetTop;
				console.info(position + " > " + $(obj).attr("id"));
				if(position >= 100){
					if(obj.className.indexOf("starLeft") == -1){
						obj.className = ' starLeft';
					}
				}
			} */
		/*]]>*/
	</script>
	
	<body class="lrfBody">
		<div class="errorMsg" th:text="${msg}"></div>
		<div class="lrfDiv">
			<div class="container">
				<form th:action="@{/authentication}" method="post">
					<input type="hidden" name="type" value="admin" />
					<div style="padding:5px 10px">
						<div>用户名:</div>
						<input type="text" class="easyui-textbox" id="j_username" name="j_username" style="width:100%" data-options="height:45,required:true,validateOnCreate:false,iconCls:'icon-man',iconAlign:'left',iconWidth:40"/>
					</div>
					<div style="padding:5px 10px">
						<div>密码:</div>
						<input type="password" class="easyui-textbox" id="j_password" name="j_password" style="width:100%" data-options="height:45,required:true,validateOnCreate:false,iconCls:'icon-lock',iconAlign:'left',iconWidth:40"/>
					</div>
					<div style="padding:5px 10px">
						<div>验证码:</div>
						<input type="text" class="easyui-textbox" name="captcha" data-options="width:150,height:40,required:true,validateOnCreate:false"/>
						<img onclick="update(this)" class="captcha" alt="captcha" title="点击更换" th:src="@{/captcha}"/>
					</div>
					<div style="padding:5px 12px;">
						<input id="rember" type="checkbox" style="vertical-align: middle;" /> 
						<span>记住我</span>
					</div>
					<div style="padding:5px 10px;text-align:center">
						<a id="login" class="easyui-linkbutton c8" data-options="fit:true">登 录</a>
					</div>
				</form>
			</div>
		</div>
	</body>
</html>
