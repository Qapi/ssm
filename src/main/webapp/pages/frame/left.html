<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
	<head th:include="fragment/import :: header"></head>
	<body>
		<script type="text/javascript" th:inline="javascript">
			/*<![CDATA[*/
			    function convert(rows){
					function exists(rows, parentId){
						for(var i=0; i<rows.length; i++){
							if (rows[i].id == parentId) return true;
						}
						return false;
					}
					
					var nodes = [];
					// get the top level nodes
					for(var i=0; i<rows.length; i++){
						var row = rows[i];
						if (!exists(rows, row.parentId)){
							nodes.push({
								id:row.id,
								text:row.text,
								attributes:row.attributes
							});
						}
					}

					var toDo = [];
					for(var i=0; i<nodes.length; i++){
						toDo.push(nodes[i]);
					}
					
					while(toDo.length){
						var node = toDo.shift();	// the parent node
						// get the children nodes
						for(var i=0; i<rows.length; i++){
							var row = rows[i];
							if (row.parentId == node.id){
								node.state = "closed";
								var child = {id:row.id,text:row.text,attributes:row.attributes};
								if (node.children){
									node.children.push(child);
								} else {
									node.children = [child];
								}
								toDo.push(child);
							}
						}
					}
					return nodes;
				}       
			           
			    $(function(){
					$('#navigate').tree({
					    url:[[@{/user/getMenus}]],
					    animate:true,
					    onClick: function(node){
							var url = node.attributes;
					    	if(url != ""){
								$("#right").panel("refresh",rootPath + url);
							}
						},
					    loadFilter: function(rows){
							return convert(rows);
						},
						onLoadSuccess: function(node, data){
							/* 树节点文本显示的样式 */
							$.each($("#navigate div"),function(){
								var obj = $(this);
								obj.css("color","red");
								obj.css("padding","10px 0px");
							});
							
							/* 去掉树节点前面的图片 */
							$.each($(".tree-icon"),function(){
								//$(this).css("background","none");
							});
						}
					}); 
			    });
			/*]]>*/
		</script>
		
		<!-- 导航菜单 -->
		<div style="margin: 10px 30px;">
			<ul id="navigate"></ul> 
		</div>
	</body>
</html>
